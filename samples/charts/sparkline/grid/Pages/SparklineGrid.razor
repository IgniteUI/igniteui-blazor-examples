@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Rendering
@using IgniteUI.Blazor.Controls
@inject IIgniteUIBlazor IgniteUIBlazor;

<div class="igContainer">
    <div class="igComponent">
        @if (DataSource != null)
        {
            <DataGrid Height="100%" Width="100%"
                      RowHeight="70"
                      AutoGenerateColumns="false"
                     
                      DataSource="@DataSource">
                <TextColumn Field="ProductID" HeaderText="ID" Width="90" 
                            HorizontalAlignment="@CellContentHorizontalAlignment.Center" />
                <TextColumn Field="ProductName" HeaderText="Product" Width="140" />
                <NumericColumn Field="ProductPrice" HeaderText="Price" Width="100" 
                               PositivePrefix="$" ShowGroupingSeparator="true"
                               MinFractionDigits="2" />
                
                @* custom sparkline solumn: *@
                <TemplateColumn Field="OrderHistory" Width="200"
                                HeaderText="Order History" 
                                HorizontalAlignment="CellContentHorizontalAlignment.Center">
                    <Template>
                        <RenderFragment>
                            @*TODO make sparkline fill out gird's cell such that it works when resizing column*@
                            @*NOTE grid does not render sparkline when its container has 100% dimensions*@
                             <div style="width: 150px; height: 50px; background: lightgray">
                                 <Sparkline Height="100%" Width="100%"
                                            DataSource="@((context.RowItem as Product).OrderHistory)"
                                            DisplayType="SparklineDisplayType.Line"
                                            ValueMemberPath="Sold"
                                            LabelMemberPath="Week"
                                            Brush="rgb(21, 190, 6)">
                                 </Sparkline>
                             </div>
                        </RenderFragment>
                    </Template> 
                </TemplateColumn>

                <NumericColumn Field="OrderCount" HeaderText="Orders" Width="110" 
                               HorizontalAlignment="CellContentHorizontalAlignment.Center" />
                <NumericColumn Field="Profit" Width="120" PositivePrefix="$" ShowGroupingSeparator="true" />
                
                <ImageColumn Field="CountryFlag" HeaderText="Country" Width="120" 
                             ContentOpacity="1" HorizontalAlignment="CellContentHorizontalAlignment.Center" />
                <TextColumn Field="Status" HeaderText="Status" Width="110" 
                            HorizontalAlignment="CellContentHorizontalAlignment.Center" />
            </DataGrid>
        }
    </div>
</div>

@code {

    private List<Product> DataSource;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        DataGridModule.Register(IgniteUIBlazor);
        SparklineModule.Register(IgniteUIBlazor);

        this.DataSource = Products.GetData(20);
    }
}
